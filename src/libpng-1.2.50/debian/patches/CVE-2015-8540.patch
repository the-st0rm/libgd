From 520b373ee53e92dce93917fea5a609b2a0291472 Mon Sep 17 00:00:00 2001
From: Glenn Randers-Pehrson <glennrp at users.sourceforge.net>
Date: Wed, 9 Dec 2015 09:33:54 -0600
Subject: [PATCH] [libpng12] Fixed an out-of-range read in png_check_keyword()
 (Bug report from

Qixue Xiao).
---
 ANNOUNCE   | 48 ++++++++++++++++++++++--------------------------
 CHANGES    |  8 ++++++--
 pngwutil.c |  2 +-
 3 files changed, 29 insertions(+), 29 deletions(-)

diff --git a/pngwutil.c b/pngwutil.c
index bc6c986..182f8db 100644
--- a/pngwutil.c
+++ b/pngwutil.c
@@ -1285,7 +1285,7 @@ png_check_keyword(png_structp png_ptr, png_charp key, png_charpp new_key)
    {
       png_warning(png_ptr, "trailing spaces removed from keyword");
 
-      while (*kp == ' ')
+      while (key_len && *kp == ' ')
       {
          *(kp--) = '\0';
          key_len--;
